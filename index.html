<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>BetWin — Prediction (Demo + Bot + Wallet UI)</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  :root{
    --bg:#0d1117; --panel:#111827; --muted:#94a3b8; --text:#e5e7eb;
    --accent:#22c55e; --danger:#ef4444; --glass:rgba(255,255,255,0.03);
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Arial;}
  header{padding:14px 18px;border-bottom:1px solid rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:space-between;gap:12px}
  header h1{margin:0;font-size:18px}
  .top-controls{display:flex;gap:8px;align-items:center}
  .balance{font-weight:700}
  .btn{border:0;border-radius:8px;padding:8px 12px;font-weight:700;cursor:pointer;background:var(--glass);color:var(--text)}
  .btn-primary{background:var(--accent);color:#04280c}
  .btn-danger{background:var(--danger);color:#fff}
  main{max-width:1100px;margin:18px auto;padding:12px;display:grid;grid-template-columns:1fr 360px;gap:16px}
  .card{background:var(--panel);border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.03)}
  #chartCard{grid-column:1 / span 1}
  canvas{width:100%!important;height:320px!important;border-radius:8px}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .small{font-size:13px;color:var(--muted)}
  .muted{color:var(--muted)}
  .grid{display:grid;gap:10px}
  .wallet-row{display:flex;gap:8px;align-items:center}
  input,select{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px 10px;border-radius:8px;color:var(--text);outline:none;width:100%}
  label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
  .qr{width:140px;height:140px;border-radius:8px;background:#071026;display:block}
  .faq .q{width:100%;text-align:left;background:#071125;border:1px solid rgba(255,255,255,0.03);color:var(--text);padding:10px;border-radius:8px;cursor:pointer}
  .faq .a{display:none;padding:10px;background:#071125;border-radius:8px;margin-top:6px;color:var(--muted)}
  .bot-box{display:flex;gap:8px;align-items:center;margin-top:8px}
  .status{font-size:14px;margin-left:6px;color:var(--muted)}
  footer{max-width:1100px;margin:12px auto;color:var(--muted);font-size:13px;padding:12px}
  @media (max-width:980px){ main{grid-template-columns:1fr} canvas{height:260px!important} .qr{width:120px;height:120px} }
</style>
</head>
<body>

<header>
  <h1>BetWin — Prediction Game</h1>
  <div class="top-controls">
    <div class="balance">Balance: $<span id="balance">100</span></div>
    <button class="btn" id="addBtn" title="Add small demo balance">+ Add</button>
    <button class="btn" id="depositBtn">Deposit</button>
    <button class="btn" id="withdrawBtn">Withdraw</button>
    <button class="btn" id="botToggle">Bot: OFF</button>
  </div>
</header>

<main>
  <!-- Chart + Game -->
  <section id="chartCard" class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <div class="small muted">Live Chart</div>
        <div style="font-weight:700;font-size:16px" id="pairLabel">BTC/USDT (demo)</div>
      </div>
      <div class="small muted">Graph persists on refresh (local)</div>
    </div>

    <canvas id="gameChart"></canvas>

    <div class="controls">
      <button class="btn btn-primary" id="upBtn">Predict UP 📈</button>
      <button class="btn btn-danger" id="downBtn">Predict DOWN 📉</button>
      <div class="status" id="gameStatus">Ready</div>
      <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
        <div class="small muted">Stake: $</div>
        <input id="stakeInput" type="number" value="10" style="width:80px"/>
      </div>
    </div>

    <div style="display:flex;gap:12px;align-items:center;margin-top:12px">
      <div style="display:flex;gap:6px;align-items:center">
        <label style="margin:0 6px 0 0" class="small muted">Auto-bet settings</label>
        <div class="bot-box">
          <label class="small muted">Interval (s)</label>
          <input id="botInterval" type="number" value="6" style="width:70px"/>
          <label class="small muted">Max bets</label>
          <input id="botMax" type="number" value="0" style="width:70px"/>
        </div>
      </div>
      <div style="margin-left:auto" class="small muted">Last tick: <span id="lastTick">—</span></div>
    </div>
  </section>

  <!-- Right column: Wallet / Withdraw / FAQ -->
  <aside class="card" style="height:100%;display:flex;flex-direction:column;gap:12px">
    <div>
      <div class="small muted">Wallet</div>
      <div class="grid" style="margin-top:8px">
        <div>
          <label>Select Network</label>
          <select id="chainSelect">
            <option value="bep20">BEP20 (BSC)</option>
            <option value="polygon">Polygon (PoS)</option>
            <option value="ton">TON</option>
          </select>
        </div>
        <div>
          <label>Deposit Address</label>
          <input id="depositInput" readonly />
          <div class="small muted" id="addrWarn"></div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <button class="btn" id="copyAddr">Copy</button>
          <a id="exploreLink" class="btn" target="_blank" rel="noopener">Explorer</a>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <div><img id="qrImg" class="qr" alt="qr"/></div>
          <div style="flex:1">
            <label>Withdraw To (your wallet)</label>
            <input id="withdrawTo" placeholder="0x or TON address"/>
            <label class="small muted" style="margin-top:8px">Amount (USDT)</label>
            <input id="withdrawAmt" type="number" min="1"/>
            <div style="display:flex;gap:8px;margin-top:8px">
              <button class="btn" id="requestWithdrawBtn">Request Withdraw</button>
              <button class="btn" id="viewQueueBtn">View Queue</button>
            </div>
            <div class="small muted" id="walletMsg" style="margin-top:8px"></div>
          </div>
        </div>
      </div>
    </div>

    <div>
      <div class="small muted">Three Doubts</div>
      <div class="faq" style="margin-top:8px">
        <button class="q" onclick="toggleFaq(0)">How do I win?</button>
        <div class="a">Choose UP if you think next tick will be higher; DOWN if lower. Result settles after configured interval (default 5s).</div>
        <button class="q" onclick="toggleFaq(1)">Is it real money?</button>
        <div class="a">Wallet addresses shown. To make deposits/withdrawals real you must integrate backend which verifies on-chain transfers.</div>
        <button class="q" onclick="toggleFaq(2)">Can I withdraw?</button>
        <div class="a">Yes—use Request Withdraw. Requests are saved locally (or send to backend) and admin approves for on-chain send.</div>
      </div>
    </div>

    <div style="margin-top:auto">
      <div class="small muted">Admin debug</div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button class="btn" id="exportData">Export Data</button>
        <button class="btn" id="clearData">Clear All</button>
      </div>
      <div class="small muted" style="margin-top:8px">Note: For real usage, replace localStorage read/write with backend APIs.</div>
    </div>
  </aside>
</main>

<footer>Built for demo — integrate backend for real on-chain deposits & payouts.</footer>

<script>
/* ------------------ Config / Addresses ------------------ */
const ADDRS = {
  bep20: "0xE1D4b2BEC237AEDDB47da56b82b2f15812e45B44",
  polygon: "0xE1D4b2BEC237AEDDB47da56b82b2f15812e45B4", // verify full address
  ton: "EQAj7vKLbaWjaNbAuAKP1e1HwmdYZ2vJ2xtWU8qq3JafkfxF"
};
const EXPLORER = {
  bep20: a => "https://bscscan.com/address/" + encodeURIComponent(a),
  polygon: a => "https://polygonscan.com/address/" + encodeURIComponent(a),
  ton: a => "https://tonviewer.com/" + encodeURIComponent(a)
};

/* ------------------ Persistence Keys ------------------ */
const LS = {
  balance: "bw_balance_v1",
  graph: "bw_graph_v1",
  withdrawQueue: "bw_withdraw_q_v1",
  botState: "bw_bot_v1"
};

/* ------------------ Balance ------------------ */
let balance = parseFloat(localStorage.getItem(LS.balance) || "100");
const balanceEl = document.getElementById("balance");
function updateBalanceUI(){ balanceEl.textContent = Number(balance).toFixed(2); }
updateBalanceUI();
document.getElementById("addBtn").addEventListener("click", ()=>{ balance += 10; localStorage.setItem(LS.balance, balance); updateBalanceUI(); });

/* ------------------ Chart (persistent, smooth) ------------------ */
const ctx = document.getElementById("gameChart").getContext("2d");
let saved = JSON.parse(localStorage.getItem(LS.graph) || "null");
let labels = saved?.labels || [];
let prices = saved?.prices || [];
let lastPrice = (saved && typeof saved.lastPrice === "number") ? saved.lastPrice : 100.00;
if(!labels.length){
  for(let i=0;i<60;i++){ labels.push(i.toString()); prices.push(80 + Math.round(Math.random()*40)); }
  lastPrice = prices[prices.length-1];
}
const chart = new Chart(ctx, {
  type: 'line',
  data: { labels, datasets: [{ label:'Price (demo)', data: prices, borderColor:'#22c55e', borderWidth:2, tension:0.25, pointRadius:0 }] },
  options: { animation:false, responsive:true, plugins:{legend:{display:false}}, scales:{x:{display:false}, y:{beginAtZero:false}} }
});
function pushTick(){
  const change = (Math.random()*6 - 3) + Math.sin(Date.now()/5000)*2; // mix randomness + smooth wave
  lastPrice = Math.max(1, +(lastPrice + change).toFixed(2));
  labels.push((parseInt(labels.at(-1)||0) + 1).toString());
  prices.push(lastPrice);
  if(labels.length > 120){ labels.shift(); prices.shift(); }
  chart.update();
  localStorage.setItem(LS.graph, JSON.stringify({labels, prices, lastPrice}));
  document.getElementById("lastTick").textContent = lastPrice;
}
setInterval(pushTick, 1000);

/* ------------------ Prediction logic ------------------ */
let currentBet = null; // {dir, stake, lockPrice, timeoutId}
const settleSeconds = 5; // how many seconds to settle prediction

function placeBet(direction, stake){
  if(currentBet){ alert("Wait for current bet to settle"); return false; }
  if(stake <= 0 || stake > balance){ alert("Invalid stake or insufficient balance"); return false; }
  currentBet = { dir:direction, stake:stake, lockPrice:lastPrice };
  document.getElementById("gameStatus").textContent = `Placed ${direction.toUpperCase()} @ ${currentBet.lockPrice} — settling in ${settleSeconds}s`;
  // settle after settleSeconds
  setTimeout(() => {
    const win = (currentBet.dir === 'up' && lastPrice > currentBet.lockPrice) || (currentBet.dir === 'down' && lastPrice < currentBet.lockPrice);
    if(win){ balance += currentBet.stake; showToast(`Win +$${currentBet.stake}`,'success'); }
    else { balance = Math.max(0, balance - currentBet.stake); showToast(`Lose -$${currentBet.stake}`,'error'); }
    localStorage.setItem(LS.balance, balance);
    updateBalanceUI();
    document.getElementById("gameStatus").textContent = "Ready";
    currentBet = null;
  }, settleSeconds*1000);
  return true;
}

/* Hook UI */
document.getElementById("upBtn").addEventListener("click", ()=> {
  const s = parseFloat(document.getElementById("stakeInput").value||"0");
  if(placeBet('up', s)){} 
});
document.getElementById("downBtn").addEventListener("click", ()=> {
  const s = parseFloat(document.getElementById("stakeInput").value||"0");
  if(placeBet('down', s)){}
});

function showToast(msg, type){
  const el = document.getElementById("gameStatus");
  el.textContent = msg;
  el.className = 'stat ' + (type==='success' ? 'success' : 'error');
  setTimeout(()=>{ el.textContent = ''; el.className = 'stat'; }, 2200);
}

/* ------------------ Bot (auto-play) ------------------ */
let bot = { on:false, interval: parseInt(document.getElementById("botInterval").value||"6",10), maxBets: parseInt(document.getElementById("botMax").value||"0",10), betsMade:0, stake: parseFloat(document.getElementById("stakeInput").value||"10") };
const botToggleBtn = document.getElementById("botToggle");
let botTimer = null;

function startBot(){
  bot.on = true; bot.betsMade = 0;
  botToggleBtn.textContent = 'Bot: ON';
  runBotCycle();
  localStorage.setItem(LS.botState, JSON.stringify(bot));
}
function stopBot(){
  bot.on = false; bot.betsMade = 0;
  botToggleBtn.textContent = 'Bot: OFF';
  if(botTimer) clearTimeout(botTimer);
  localStorage.setItem(LS.botState, JSON.stringify(bot));
}
function runBotCycle(){
  if(!bot.on) return;
  // read fresh settings
  bot.interval = Math.max(1, parseInt(document.getElementById("botInterval").value||"6",10));
  bot.maxBets = parseInt(document.getElementById("botMax").value||"0",10);
  bot.stake = Math.max(1, parseFloat(document.getElementById("stakeInput").value||"10"));
  if(bot.maxBets > 0 && bot.betsMade >= bot.maxBets){ stopBot(); showToast("Bot finished", "success"); return; }
  // simple strategy: predict direction randomly weighted by last drift
  const drift = lastPrice - (prices[prices.length-2] || lastPrice);
  let dir = Math.random() < 0.5 ? 'up' : 'down';
  if(Math.abs(drift) > 0.25) dir = drift > 0 ? 'up' : 'down';
  if(balance >= bot.stake){
    placeBet(dir, bot.stake);
    bot.betsMade++;
  } else {
    showToast("Bot stopped: insufficient balance", "error");
    stopBot();
    return;
  }
  botTimer = setTimeout(runBotCycle, bot.interval*1000);
}

botToggleBtn.addEventListener("click", () => {
  if(bot.on) stopBot(); else startBot();
});

/* restore bot state */
const savedBot = JSON.parse(localStorage.getItem(LS.botState) || "null");
if(savedBot && savedBot.on){ document.getElementById("botInterval").value = savedBot.interval || 6; document.getElementById("botMax").value = savedBot.maxBets || 0; startBot(); }

/* ------------------ Wallet UI ------------------ */
const chainSelect = document.getElementById("chainSelect");
const depositInput = document.getElementById("depositInput");
const qrImg = document.getElementById("qrImg");
const exploreLink = document.getElementById("exploreLink");
const addrWarn = document.getElementById("addrWarn");

function updateWalletUI(){
  const c = chainSelect.value;
  const addr = ADDRS[c] || "";
  depositInput.value = addr;
  qrImg.src = "https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=" + encodeURIComponent(addr);
  exploreLink.href = EXPLORER[c](addr);
  // basic validation
  addrWarn.textContent = "";
  if((c==='bep20' || c==='polygon') && !/^0x[a-fA-F0-9]{40}$/.test(addr)) addrWarn.textContent = "⚠️ Address seems invalid (0x + 40 hex).";
  if(c==='ton' && !/^([A-Za-z0-9_-]{48,55})$/.test(addr)) addrWarn.textContent = "⚠️ TON address format unusual — verify.";
}
chainSelect.addEventListener("change", updateWalletUI);
updateWalletUI();

document.getElementById("copyAddr").addEventListener("click", ()=> {
  navigator.clipboard.writeText(depositInput.value || "");
  showToast("Deposit address copied", "success");
});

/* ------------------ Withdraw Request Queue (frontend) ------------------ */
function requestWithdraw(){
  const to = document.getElementById("withdrawTo").value.trim();
  const amt = parseFloat(document.getElementById("withdrawAmt").value || "0");
  const chain = chainSelect.value;
  const msgEl = document.getElementById("walletMsg");
  if(!to || !amt || amt <= 0){ msgEl.textContent = "Enter valid address & amount."; msgEl.className = "muted"; return; }
  if(amt > balance){ msgEl.textContent = "Insufficient balance."; msgEl.className = "muted"; return; }
  // queue locally (backend would handle in real app)
  const q = JSON.parse(localStorage.getItem(LS.withdrawQueue) || "[]");
  const req = { id: Date.now(), chain, to, amount: amt, status: "pending" };
  q.push(req);
  localStorage.setItem(LS.withdrawQueue, JSON.stringify(q));
  msgEl.textContent = "Withdraw request queued (admin approval needed).";
  msgEl.className = "muted";
  document.getElementById("withdrawTo").value = ""; document.getElementById("withdrawAmt").value = "";
}

/* View queue */
document.getElementById("requestWithdrawBtn").addEventListener("click", requestWithdraw);
document.getElementById("viewQueueBtn").addEventListener("click", ()=>{
  const q = JSON.parse(localStorage.getItem(LS.withdrawQueue) || "[]");
  if(!q.length) return alert("No withdraw requests in queue.");
  let txt = q.map(r => `#${r.id} | ${r.chain} | to: ${r.to} | $${r.amount} | ${r.status}`).join("\n");
  alert("Withdraw Queue:\n\n" + txt);
});

/* ------------------ Export / Clear ------------------ */
document.getElementById("exportData").addEventListener("click", ()=>{
  const data = {
    balance: localStorage.getItem(LS.balance),
    graph: JSON.parse(localStorage.getItem(LS.graph)||"null"),
    withdrawQueue: JSON.parse(localStorage.getItem(LS.withdrawQueue)||"[]")
  };
  const blob = new Blob([JSON.stringify(data, null, 2)], {type:"application/json"});
  const url = URL.createObjectURL(blob); const a = document.createElement("a"); a.href = url; a.download = "betwin_export.json"; a.click(); URL.revokeObjectURL(url);
});
document.getElementById("clearData").addEventListener("click", ()=>{
  if(!confirm("Clear all local demo data (balance, graph, queues)?")) return;
  localStorage.removeItem(LS.balance); localStorage.removeItem(LS.graph); localStorage.removeItem(LS.withdrawQueue); localStorage.removeItem(LS.botState);
  location.reload();
});

/* ------------------ Simple UI helpers ------------------ */
function toggleFaq(i){ const a = document.querySelectorAll('.faq .a')[i]; if(!a) return; a.style.display = a.style.display==='block' ? 'none' : 'block'; }
window.toggleFaq = toggleFaq;

document.getElementById("depositBtn").addEventListener("click", ()=> { alert("Send funds to the deposit address shown on right. Backend needed to auto-detect & credit."); });
document.getElementById("withdrawBtn").addEventListener("click", ()=> { document.getElementById("withdrawTo").focus(); });

/* update balance UI when page loads (in case changed) */
updateBalanceUI();

</script>
</body>
</html>
